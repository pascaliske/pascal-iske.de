language: node_js
node_js:
  - '13'
addons:
  apt:
    packages:
      - libgconf-2-4
  chrome: stable
cache:
  yarn: true
  directories:
    - "~/.cache"
install:
  - yarn install --frozen-lockfile
script:
  - yarn run lint
  - yarn run build:app --progress false --base-href https://$PROD_DOMAIN
  - yarn run build:server --progress false
  - yarn run build:cfn
  - yarn run build:prerender
  - yarn run bundlewatch
  - yarn run e2e
after_deploy:
  - yarn run lighthouse --output-path=./report.html https://$PROD_DOMAIN
  - yarn run now report.html --token $NOW_TOKEN --no-clipboard --public
  - yarn run sentry-cli releases new "$TRAVIS_TAG"
  - yarn run sentry-cli releases set-commits --auto "$TRAVIS_TAG"
  - yarn run sentry-cli releases files "$TRAVIS_TAG" upload-sourcemaps ./dist --no-rewrite
  - yarn run sentry-cli releases deploys "$TRAVIS_TAG" new -e production
  - yarn run sentry-cli releases finalize "$TRAVIS_TAG"
deploy:
  provider: firebase
  token:
    secure: UhGOJCPxiUIKaneko+V5Myxpwv5Tc6aaohRrSeHgNZxlV4xKJx1nyNKb19b3w0co7xokLGgnbX3dXehVM1J4pRduj21RVYZntp0A0xooZi5Jj7GTBIDIUGCbG7jTYcDr5hG2xOXtGR0TuVeaQPHRTdwWFqhgw/B92xRkzD9xBjDLUpBeoiW2BfUD7VlCy2DlPc13+nXwS1f+ybL3uIrZuNsww1ACQt3snDTnIBVqvZA+UDg+9Tl88yHEURJ0Ijp5CVmWY/+ZknKiFeuaP/S15zo4Nsm7bhFH2dQPlsRW0PEn5ereZRuErxpVBBHGPlTeV7qgxz2L3qgatdMx2T7J57TAxYV3KKUnnEdEZi/AoSVqgX8s5XDXcUendN/+OtmFmM7MGOmkZNgpi+Vne+yLLh/qioHwhKsoAK8TKFYOFKJiWVI/MRvoKAXTaOPWIpjrrw2KJIlMJBZvsWk8kEiDFUcPdTg/vlAzAILKfWKBvJD6g1g7QbkHVV4wyXSDZs11JE1mGX0CttIQPi3NK7NK59z9qQBZCMwtZglAh1cgJ+zBlrG11n/UDmY7b9cZ/z5/uQpxZm3U5w5R5TIwCTzAKf6Pm9pfJjJ+NYeyhvlt7ffESPKoMNj/UutqeU518RrKB8Dbhy80NZA3FGU2brJ45+C+7gkrl5dK5dNsJkr+SI4=
  skip_cleanup: true
  on:
    tags: true
    branch: master
    node: 13
env:
  global:
    - secure: QY+1MYVMPURyBBojv89X2CFMpXTIHPDaDgscT4D3ONm5pEeQLU1TNG9IQWcJzlCJb3xpwibROYCFo8cwwnSmGK0zapFRJaceAXtXwY6RwCtBpUw4AbPpI1zJb1ch+Gj3glHEH2T6TY0LbyGa5ZWdeW8Ppwo7u5X++W9F+kLcp+z+jAXvEeVynZ4aE9rgz+j7DdJrNzVGelCQNBGBlns4vyTdJxLfjSHzg58F5Yzrbn9PshtV9imMMkYdYVOTulTuNbEKDYltUKpASrT4Nz5eEV6k5l+VtqL6GCmB2pM0vUtI5Z6BciWBRePm0UiGpYUGqO+Wd3D+c95r5RP6j3W7sNIhYCItScGuQuUGlg219qJW9nSYZ6VISpX24v59PBr8wOyJEr14AlwtohFylm5gXiqYsthdHXOV7IEODanzcrht43gF7GGpQ8OZb5bw5bWL9euJ72BqEG+5CQAnGrM2L3yjVYjdOwSSqGK1uJvbv0t5+TZI3bAMFdHVG5oJFpj1nudgmBHgt715HVP1jTayPdd23S97tfd7Um8r6eKKFfh/0x7fFW4K2kvPzx8qr972uF5LpzuO1BGU82XDf0nm1AH8kNXvfFuOeniC05SEvpcSC4GgzfZWap3eOds7HNvPJXmKlJMBpdm+Hvgx70BN0oGKJlfRIqWm+H21c3Sybbs=
    - secure: FVK0wexU71vn/EGT7SBABuTFheiPMEAxa4KOW/qG/1NQVmkV5NMYRGbvuPJ17G1222St9AksPfSQoMEJKF/N7Wc4dhAJbKdXV3c7RAHHZbQlkhcAGIwfbcmjloj+RKOFjgMEHSR7peKF5qgwFKNXD8xWeF6f9AFAdmwYk/KLK9bCiiY7CdzBt6VQfX6kIRJRfi4Lqd0KXgR4inYgeU1kBd/vM+N/T/4uHtn0p4N5fZ2C0W6cO8EEtdjh0XRYfPFliGNUGo09JmoyarxqZruj3N9L/xkF49798hUtvWJQRrZjFo72In111UAWlxUsD+7Fo29wYUbUM/Ip2rkIBJBgwaODMTgToSnsNbk9c1YZXAjxBnFsHUx+Si91btLNd4Tc7cR3QoTlxXEizHcEbH68IPd8FQl5JSuoQd+tHIe44GRtHZ3fj1pRBQvuZWwd1GzRRY1wBSOWkZvtib1AI0TAN2h4SGl6gRIFhDAT76o/nX6eo/OXcAD7RdJDpijgNT5MWUqz2mV4kYlC5D+N0alq5g8APdwt/y5nhOmt1hO7AAhqPf1q3nQZrjGRoLAA9iGgwTKkwSDQTZ2fme/Py8c9D9E1J/1riXQEUNH5Col2YZAPSXT3sZQ+OTmS47t/e1RzM/oxDch1zF6e+eAGGKletZycCHvadBwL92pFDre/PNg=
    - secure: 0eTARZMX6N4T6vp0PW9o7wKGUrAuuwQNEfjLgkEIquOTW6WkViE0LNBhTQMHrX1Kmqd2fOIaBCJJTcdz2+GMZoVI64vL9nC6zyJsipcROzZwLJstX6nc73w78T/2zu69AjPrRFnnhQ7P0wCNnZgi769VMqsxEMB2Cxn2T81n51ZPzY5MyAeKJQjqtJtmtc6GcGtkrDsgYwRYdrjtKPAeB51QuD1I9sU1H+0HAFaLD3CaCmG7ubA/BDAMIJEdj0gco5kIu6WShkeV56TMpZgOOUmPPhtzaceQrV+xtmH/psfF5EOLOsVXRrqXxbfhcatpvCYpRXoB7tXDx05egPKZimjZlDQRkcd/ritLZz2AdGcKJb44Bj1NbYnb3vGVOyCP5CsA0LOlQPq5iTIE8593pYHt3h5N02I+1MzskqhfxxJ1CWcpR1Z5OfQYrJ+TWgCLCBlZyPKHpVm0DsH6mDueRmaSWeFVxIOvZHx8Ga6SJWqqp34nnGuaYa+9WXdCx9KzgcbSTP0OsL1WSwpJy6yShQhatT2MFT3BZ1r1v6xOWO6j8jo+rwrvflYcW4xMMop3PQFPLlWBcgmDgR23kU4FR9a9Kbq4URDP2EWxyldeGRDxnQxY98CRMwu5sNtQSK79IG3ooGfWNKY0SUKjVQZSORG4sd+z+MjL8Mzhoerhdjw=
    - secure: qWUP7IRKlv7FF55+zuBs8cbjGcvelmluQ2eAGzhTDPXm/wEbalW3yFActM2vO29UGGhx4SobUH6OA6Fxyg+4B6bTIYrWVvoR9fVxMha5QihHujU3e9g932GDwI1qsfys5q1e505rKM1tLhYS55N+Q1MCVPIhRXcY2shymqvUvzhdOXuaVznuxs8PgmyHuEgSb+zhuSMnm3GR2KOiy+Shq02Wu9ZHhNmUDqs+vKai6ZJdK00weBbq0a/AQcoBjbdvNuPMrV+ZPE7skuvvjjp/6SOKpKBR/JKxFEtdMIo3OBQlix+HxBb2n8lGkZNzogOqwBTeH+5/yJyOdvwvl6AcW84z+ZyGRnCRyHH27812HT71JvZDh/LiU1wh83e9N19XF7Mp5KmfzTIY/RXogz+a8ZeE2btMAPnSVnabxYjTXHKZrqLnSk2HOtxzBZDX99iguBfATA3nEsblpIPPbEV8A/h550sLGWa9hvZSZJnzEDkrCtsOCMxu3N8ABgEU4+jKE49Uw1EGGmWRW58Lr6UkNR2l7ye/t1o2REr3L3hfuldVuSFye5PQ4j5vrmZPDEAmXhQAXuPG5laKHdtfsiCcpVXry6c/0QS6UH8YJStLWxCWHjhCuF8WONTIji0yIENqcgBi9w6F0FauVhz/g6EHiWx1dKLvva2ss3yAhH/CtmY=
    - secure: 2MK4fulcoBYTFuoN2SzXYIHnDSIc5hkMw3j49sM8N+G64/ikztYSB5PHjbwOW8nASzLOgX2w1suHis8cwBkcG9KP6+bUol0PcxYCIW6cjiTD8yBQowXe+R4SxaQ2TxIXTpTkG4zLNoGSrFwICe9/ZBBBpWtD2/kPI8V3S+Q39TXmpUXP1sMA6t8u4rt9RDJKKj2XI8aIVfZYkLB5hTGoS+wtFSXgXFZ31GA1f56hIRVIii627RHWicebtkTZIoralKCXBaSWEPXseW6kide3YGfsK8Rzz6qGWBbqEQQEpLxgQUxzXYASF3fimJiLV1Y+7Jl+wQkzFjSIK3GfezaW/k/opUpMQ+waCIyhTcMry9MjkiVpvILG8czHdzy3mFj7CFeJKtIXwDmofdBA9xnsWtoodW7KOpPqUOG42nPvrFwojyDGxPyV0aGJ9rCeRX0D4vi7C7wg66g0AD0PaSKLP9FyLI5nWYruPAJctBz4xtldEix37vWQt1b9/eWv8IaUCA2ijYL1+DSD8uk1NIN5JPitTWWDq58zhRe3mBzFSWnACOKkoi6GYbpBbd8iv7ptuoIWB505a0Dn+hQMh/rxQ52K9q/mBJ3RZublUIQqUtXVwnuOgYjwLaIrYXkgeKlLm5jiYtFc6eBKQ/RS0Tswrst3s/R4rZsyELOeFJj9rf4=
    - secure: HEh/Y9EGXzXE0TYLhO0gA4wVXzYbM9dgr+labe7Ym5czeeiSbXvAgb+RTkCURL3m18Ul6bQwZ0pdNNiBCVpJ/iHBOXZ1MG4KP9MoYLs0qK7ugKvSpYJAmu5QWu0MxVObWX6xPEWWWTW5TWKdSyjeh8kKu1tL2m1l5MS0WS099GFqN3Hk4FmdQM1GP2wrTqBbTQwOGyIrQVVkqsI92voxJvZiZfDzvzPlKp+8Lvp1JQ7TX1P55Om19ob22rCrV2DbMYAxIYaZRfJyw8ycIUAxhXKLSBagTncnDnfeSwGvzeBvnOj8cHH/B2UJnhZGQH0WoIxxNJQ1K/nFEvxCrqmmxrmrTGqiWLsbK/CDCwEG/zKC2URZVUfbXslGFfbiq4AwAgD9g92yJnEXrpZ7qKAuoCMlACLmVre8hndPHZvFUNdEotl7XH0ZjV3Pcpom6oJ3VQtFpTEuUQVFs1PZG/rJSVIDVIHrbxBf3CoSQhfrgRqmQYtJkCIQXsW6EvLvbvLPpnGhCChnvOTmviO4Ke1JNq7j8KvExBmkcv/GwHlEMr/ESItKx9Q8fpe/n6GRQkt+2baAErEMXUPKvTsuOwVTr7SZqyge756fI87uNc1WRLPxJYGusuD4hzSQF/VOHYzp01Prrg4JULsF6Lg7VviHLXptyOHnnidCWVYZXa06efQ=
    - secure: qHeiUT/OUy+oPZnkZfCs3J8CEk9rJOM4h3x4h+vh+9Tic3zvRy1ICvvPMBfXYW93px06t5UigGHhY7iI89r54KTqITj63EXwDPIGivKCqXkJC2xwtsyOl7QCU5AREJJUy/+N3kqhV3KPtMTDeQQKea+h94CVnyDIRXFPl4aqwxmZ+80ZJWzHrtKtgm/FE4Rg6lXiNaWm4Pv5ze1a3/el/t5TsbQdaWZE/Dbg6FLc/0f4DRhIdnPuwWwRymqFkXwh361I83HyCgueT1SVE6YVSwB8wg2vyubWRsD/pwPDRzgnXH8BYxah6Fgl/0gBc8jMxADbT577WSRlenSQyp9RaN8Ibs6GmNAt+uB+IUrbOSwpTNjVvIS9CuLieZWldSjJZx5mWHArnlohnkIpgp7AHOBVCzf0k4m+uwTcpo4M81n/xJB/h6ub94fGwvpCT4sl6sdrcSRW3FPOhkfOEml36M+bzUqBko+JDDKygs8fOITxUiT7Da3Q5iA/TbWqJJrDOxqYx8QlQvNrK++b1aZcIjiJPkJqWSeKuKONkME2NJ5B+wkp6h0zZXPlE2eFJ7P31//H7UH13ExuxR67S63HsFeJFYOHRyWB3L3ltVgYh6xViT+YZFAp0cL589kD+faLdw65kjCe+9v/6mBjgWfjYP2vcwdqSBRZ4JAe7ARj3xs=
    - secure: OKTgofiNStUctypPRNNBKs+MyVVFZOOBDJ4CKLB6IUl6KmKY6QOFB3OF9uoolP3jxWL0bqebEXWmwStCArCmx+nf/gvXkWVqdwuDt6EVjmO4dsrlF1BV534PW7ArNsnPJwICT3iQ2qVYElc4a4beu7QRkdmzDjbDVnycu6oga14K3SDgT6rJuXXRYQKfNAAHjTZWJvb/NskLvAFuskvHS73WfbfoJvMbZEYDdtGd1za319Z3ESihx+9xkHdDczDebXxeWNODxKJf8Xu73yXdj2l5pwKZzW+++xsaYBTQOreAKRd7fz6Tt7KB0uiLMbiGSaxuNqx1FKz0yo01pLEUwGtNPeez51cTIcbsWZ4P/i8facFaHmx52uS5CDZsTjWIMNLcOIPEiok4hhQt94cGVcWYaw2fRnJwVd3zVW9P0MasnNt/fptKlZs2mWmIvqaMc+HHx036tjoQyyy88mGgpfUtmLwdkzspV7l6ELgBUFvLWYexmQAcW+V1sThNSjB4nHSzQKS1UsuxJbRAuTFbgy6kgJ1ifsdYaj7hgXuBo01isjO9YfnMSuRxxPR9DIHeQltsbpCoUvjpp1byv9vTBPHhkAyt51AVpYtbfEPSQLgfeUMDhyuCyTsFdmHKbZz83kUEUvs070M4zuAN2RP7CEdBtTqEn3kB5tZeQy4LiJc=
    - secure: Y2JZib9b6jkSi3yifWG0HnYcuXE5UTUBoCSMGlk5w6Edf6GTk/983CX6horrqqkFF9lgprIGxPbAcOjWUIKe/y3DG8nNDh0Zw1SU/UP4BRbJ5CX7pWh0cjAsHyVbvYpg/X5u2koRGB6fKXSlK1pNIjDOamMuLgv0FTTTGA5UW9cdSwuGD6GpfNayUu6T5RSJ4W2cL3iX4OFNYECXtzvMK+MfOSQtOckKBctBTZE+vI/rF6BfTqr8pgZMyOKGM8moln1AUqfuT8yn5BeYoxckhG52ce7ii8UwRdK9F1Nu5LzgBR0q9lEGuGijNQRucYZeFp6oCs3sapaCyaYyStUiynoM1XmeYi5cRIEs8zKAoROKqXM7DGBLU9n/Z5JiRgFEJ64M8AHc05D1k2jWjP8+eqg7dJUeiPd8cYQsdvMTwHZLIAlLHIPUBDFkw2LjPd5/yCrkt72m8N+08AhASjKC2kGNkUpqHWRJjkKbFt26aQkQQjYw0EXhpaC80Fc4itQwX56xwx8k1PVcBtJqcX1V6pMle6QEok2dfT8R75KLYZXtNBmJcOHgIS/fCJ722SwLXEZEAOdNLzo60ncrHjcix8VcwzmpJOKAqj7+dKJFQMJTSXvKJguZn9LgZ1jOq4tap705DLF5Q3xyvklhOLR+CgXb4rlEZWDKUyylNZ+7QwM=
notifications:
  slack:
    rooms:
      - secure: MeMFT9uhC2UdzZaEjXiloK/yHRlB2Q5k5/gPbxmJim09v7bzu0dEdusNpWuwbZJY13KXF+pXh1UPa1ICuI/GogQ7+waUldsTE7qCWDxyOAPsZIffPvJLlX4Xnkcod/QaJL1xmb9lgqxMy1jUh0gI3qGmqQ5ZQpWTkQtlnoSoQvJd3FqA1MqVl2WvzUq4ok6rAfM29oX1oVGY3Eo/pvaCms0EyL5HZzYSTYe3mUt1lagT7W2pg9IaEyf1rgHIoReoIsL9RRsu2Luj1XJd4rR1+kR3G3ndmcs5s6XtJK+XpworMEwDjSb1y+gl2FQAhwzqvGW+A7k2u7smENtp9r8qr42T7hVB5hRj4IVnuV3VRG/TLGtQ5YTdMKzV4+IUOfXlZtKKTKxhTG36E1nlSaXs9HQcHwbCguPjYf2wDdDoe5GcaJubStCWVCVgBATg5/A7dUfbTaFfxksVNPNy7yID9n04L8N0kyHljaWOs6VHLnIoTNWRRRitsRBaydwMtIZB6ikijSwqp1WSwKvB8mHCpktB4IWLhhURRtIVY7SP/efHXwIMSM25izOKmRneLIJjiTGxNSAgWvmOTWYAgVEofsXGHEvgQPIqAx177cHv6oWJHS4WpxJACsXarMzwDzHeEbfUPelOc6Vae+zuphtnbsjHfp+pePuZk0w1NEDVJwc=
    on_success: never
    on_failure: always
    on_pull_requests: false
